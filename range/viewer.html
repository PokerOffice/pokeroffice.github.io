<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>PokerOffice / Range viewer</title>
	<link rel="stylesheet" href="/style.css">
	<style>
		.square {
			display: flex;
			width: 55px;
			height: 55px;
			background-color: #aaa;
		}

		.content {
			position: absolute;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 18px;
			color: #fff;
			padding: 5px;
		}

		#grid, .no-select {
			user-select: none;
		}

		#suitednessTable {
			width: 70%;
		}

		#suitednessTable td {
			text-align: center;
			font-size: 28px;
			cursor: pointer;
			padding: 7px;
			user-select: none;
		}

		#suitednessTable td.active {
			background-color: cyan;
		}

		.expandable-box {
			position: relative;
		}

		.expand-button {
			cursor: pointer;
			font-style: italic;
		}

		.default-input {
			display: none;
			background-color: navy;
			margin-left: 20px;
			padding: 0.1px 10px;
		}

	</style>
</head>

<body>
	<h1>Strategy editor</h1>
	<a href="/index.html">Back to menu</a>

	<div id="gridContainer" style="display: flex; flex-direction: row; gap: 20px; margin-top: 20px;">
		<!-- Holes matrix -->
		<div id="gridWrapper">
			<table id="grid"></table>
		</div>

		<!-- User parameters -->
		<div id="userInput">
			<p style="margin: 10px 0 2px;">
				Actions and range
				<span class="expand-button no-select" onclick="toggleExpand('handsInput')">
					<img src="/img/help.png" width="20">Syntax
				</span>
			</p>
			<div class="expandable-box">
				
				<div id="handsInput" class="default-input">
					<p>3 lines of <i>Actions</i>, <i>Hands</i>, <i>Weights</i></p>
					<p>Example: Cbet strategy SB vs BB</p>
					<object data="./sampleInput.txt"></object>
				</div>
			</div>
			<textarea id="inputArea" rows="4" cols="40" placeholder="Enter input"></textarea>
			<p><button onclick="updateGrid()">Update Grid</button></p>

			<hr>

			<!-- Suit control tool -->
			<p style="margin-bottom: 2px;">Suitedness</p>
			<table id="suitednessTable"></table>
		</div>
	</div>
</body>

<script src="grid.js"></script>
<script>
	function toggleExpand(divId) {
		const elem = document.getElementById(divId);
		const style = getComputedStyle(elem);

		if (style.display === "block") {
			elem.style.display = "none";
		} else {
			elem.style.display = "block";
		}
	}

	function updateGrid() {
		// Parse lines
		const lines = document.getElementById("inputArea").value.split('\n');
		if (lines.length !== 3) {
			alert("Invalid input. Please enter exactly three lines of JSON.");
			return;
		}

		// Parse hands and weights as arrays
		let actions, hands, weights;
		try {
			actions = parseActions(JSON.parse(lines[0]));
			hands = JSON.parse(lines[1]);
			weights = JSON.parse(lines[2]);
		} catch (error) {
			alert(
				"Invalid input. Please enter 3 valid JSON lines.\n\n"
				+ "Error detail:\n" + error
				);
			return;
		}

		// Validate the input
		if (!Array.isArray(hands) || !Array.isArray(weights) || hands.length * actions.length !== weights.length) {
			alert("Invalid input. Please enter valid hands and weights lists.");
			return;
		}

		// Update constants
		ACTIONS = actions;
		combos = {};
		for (let index = 0; index < hands.length; index++) {
			const combo = hands[index];
			const cWeights = [];
			for (let adex = 0; adex < ACTIONS.length; adex++) {
				cWeights.push(weights[index + adex * hands.length]);
			}
			combos[combo] = cWeights;
		}

		// Clear the grid and generate new cells
		refreshGrid();
	}

	// Restore the values of textareas from localStorage if available
	document.getElementById("inputArea").value = localStorage.getItem("inputArea");

	// Save the values of textareas to localStorage on change
	document.getElementById("inputArea").addEventListener("input", function() {
		localStorage.setItem("inputArea", this.value);
	});
</script>
</html>
