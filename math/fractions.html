<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PokerOffice / Fractions</title>
  <link rel="stylesheet" href="/style.css">
  <link rel="stylesheet" href="quiz.css">
</head>

<body>
  <div style="text-align: center;">
    <h1>Fraction to Percentage Quiz</h1>
    <a href="/index.html">Back to menu</a>

    <div class="container">
      <div class="level-links">
        <a href="?level=1" id="link_level1">Easy</a>
        <a href="?level=2" id="link_level2">Medium</a>
        <a href="?level=3" id="link_level3">Hard</a>
      </div>
      <h2>Enter the percentage equivalent of the following fraction:</h2>
      <form autocomplete="off" onsubmit="event.preventDefault(); checkAnswer();">
        <div class="question" id="question"></div>
        <input type="text" id="answer" placeholder="e.g. 75">
        <input type="submit" value="Check Answer">
      </form>
      <div class="result" id="result"></div>
    </div>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const level = parseInt(urlParams.get('level')) || 1;

    const disabledLink = document.getElementById('link_level' + level);
    disabledLink.classList.add('disabled');
    disabledLink.removeAttribute('href');

    function generateFraction() {
      // Generate random fractions p/q, with 0 < p < q < C,
      // with C depending on quiz level
      let p, q;
      switch (level) {
        case 2:
          p = getRandomInt(1, 19);
          q = getRandomInt(p + 1, 20);
          break;
        case 3:
          p = getRandomInt(1, 500);
          q = getRandomInt(p + 1, 900);
          p /= 10;
          q /= 10;
          break;
        default:
          p = getRandomInt(1, 9);
          q = getRandomInt(p + 1, 10);
          break;
      }
      return { numerator: p, denominator: q };
    }

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function getPercentage(fraction) {
      // Get the percentage equivalent of a fraction
      return (fraction.numerator / fraction.denominator) * 100;
    }

    function parseFraction(fractionString) {
      var parts = fractionString.split("/");
      return {
        display: fractionString,
        numerator: parseInt(parts[0]),
        denominator: parseInt(parts[1])
      };
    }

    function displayQuestion() {
      // Generate a random fraction
      var fraction = generateFraction();
      var fractionString = fraction.numerator + "/" + fraction.denominator;

      // Display the fraction and clear the answer field
      document.getElementById("question").textContent = fractionString;
      document.getElementById("answer").value = "";

      // Return the percentage equivalent of the fraction
      return getPercentage(fraction);
    }

    function generateMessage(imageLabel, text, correct) {
      let message = `<img src="/Icons/chess/${imageLabel}.svg" width="32"/> ` + text
      if (correct != null) {message += ` The correct answer is ${correct}%`;}
      return message;
    }

    function answerMessage(answer, correct) {
      // Generate a correction message according to answer accuracy.
      const accuracy = Math.abs(answer - correct);
      const correctAnswer = correct.toFixed(2);
      if (accuracy <= 0.001) {
        return generateMessage("best", "Correct !", null);
      }
      if (accuracy <= 1) {
        return generateMessage("correct", "Good !", correctAnswer);
        return "Good! The correct answer is " + correctAnswer + "%";
      }
      if (accuracy <= 2) {
        return generateMessage("inaccuracy", "Close guess.", correctAnswer);
        return "Close guess. The correct answer is " + correctAnswer + "%";
      }
        return generateMessage("incorrect", "Incorrect.", correctAnswer);
      return "Incorrect. The correct answer is " + correctAnswer + "%";
    }

    function checkAnswer() {
      // Check if the user's answer is correct
      var answer = document.getElementById("answer").value;
      if (answer == "") {
        document.getElementById("result").innerHTML = "Please enter an answer.";
        return;
      }
      answer = parseFloat(answer);
      if (isNaN(answer)) {
        document.getElementById("result").innerHTML = "Invalid answer. Please enter a number.";
        return;
      }
      let previousQuestion = document.getElementById("question").textContent;
      let fraction = parseFraction(previousQuestion)
      let percentage = getPercentage(fraction);

      document.getElementById("result").innerHTML = (
        `<p><strong>Your answer:</strong> ${fraction.display} = ${answer}%</p>`
        + "<p>" + answerMessage(answer, percentage) + "</p>"
      );

      // Generate a new question
      displayQuestion();
    }

    // Display the first question when the page loads
    displayQuestion();
    document.getElementById("answer").focus();
  </script>
</body>
</html>